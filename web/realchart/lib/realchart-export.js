
/** 
 * RealChart-Exporter v0.0.1
 * Copyright (C) 2023-2024 WooriTech Inc.
 * All Rights Reserved. 
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).RealChartExporter={})}(this,(function(e){"use strict";var t;function o(e,t,o,n){return new(o||(o=Promise))((function(r,s){function i(e){try{l(n.next(e))}catch(e){s(e)}}function c(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,c)}l((n=n.apply(e,t||[])).next())}))}!function(e){e.PNG="png",e.JPEG="jpeg",e.SVG="svg",e.PDF="pdf",e.Print="print"}(t||(t={})),"function"==typeof SuppressedError&&SuppressedError;class n{export(e,t,o){}$_removeItems(e,t){e.querySelectorAll(t).forEach((e=>{e.remove()}))}$_removeAriaLabelRecursively(e){e.hasAttribute("aria-label")&&e.removeAttribute("aria-label");const t=e.children;for(let e=0;e<t.length;e++)this.$_removeAriaLabelRecursively(t[e])}$_removeHiddenElementsRecursively(e){if("none"===window.getComputedStyle(e).display||"none"===e.style.display)return void e.parentNode.removeChild(e);const t=e.children;for(let e=0;e<t.length;e++)this.$_removeHiddenElementsRecursively(t[e])}}class r extends n{export(e,n,r=t.PNG){const s=n||{},i=n.fileName||"realchart",c=e.getBoundingClientRect(),l=s.width?s.width/c.width:s.scale||1,a=document.createElement("canvas"),d=a.getContext("2d");a.width=c.width,a.height=c.height,e.appendChild(a);const h=document.createElement("div");h.classList.add("rct-export-indicator"),h.style.position="absolute",h.style.width="40px",h.style.height="40px",h.style.top=(c.height+40)/2+"px",h.style.left=(c.width+40)/2+"px";const p=e.cloneNode(!0);e.appendChild(h);const u=()=>{const e=new Image;e.onload=function(){d.drawImage(e,0,0,a.width,a.height);const t=a.width*l,o=a.height*l,n=document.createElement("canvas"),s=n.getContext("2d");n.width=t,n.height=o,s.drawImage(a,0,0,a.width,a.height,0,0,t,o);const c=n.toDataURL(`image/${r}`),p=document.createElement("a");p.href=c,p.download=`${i}.${r}`,p.click(),h&&h.remove()},p.querySelectorAll("g").forEach((e=>{0===e.childElementCount&&e.remove()})),this.$_removeItems(p,".rct-contextmenu-button"),this.$_removeItems(p,".rct-feedbacks"),this.$_removeItems(p,".rct-tooltip"),s.hideNavigator&&this.$_removeItems(p,".rct-navigator"),s.hideScrollbar&&this.$_removeItems(p,".rct-axis-scrollbar"),s.hideZoomButton&&this.$_removeItems(p,".rct-reset-zoom"),this.$_removeAriaLabelRecursively(p),this.$_removeHiddenElementsRecursively(p);const t=p.querySelector(".rct-svg");this.$_imagesToBase64(p,(()=>o(this,void 0,void 0,(function*(){const o=(new XMLSerializer).serializeToString(t),n=o.indexOf(">"),i=this.$_getUsedStyles(t),l=`\n                ${o.slice(0,n+1)}\n                <style type="text/css">\n                ${i.join(" ")}\n                </style>\n                ${o.slice(n+1)}`,a=(new TextEncoder).encode(l);try{e.src="data:image/svg+xml;base64,"+btoa(String.fromCharCode.apply(null,a))}catch(t){const o=s.url||"https://exporter.realchart.co.kr/api";fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:r,size:{width:c.width,height:c.height},dom:p.outerHTML})}).then((e=>e.json())).then((({data:t})=>{e.src=`data:image/png;base64,${t}`})).catch((e=>{h&&h.remove(),console.log("error"),console.error("Error:",e)}))}}))))},m=p.style.backgroundImage;if(m&&"none"!==m){const e=new Image;e.onload=function(){d.drawImage(e,0,0,a.width,a.height),u()},e.src=m.replace(/^url\(["']?(.*?)["']?\)$/,"$1")}else u()}$_getUsedStyles(e){const t=[],o=(e.ownerDocument||document).styleSheets;for(const[n,r]of Object.entries(o))if(r.href&&r.href.match("realchart-style.css"))try{for(let o=0;o<r.cssRules.length;o++){const n=r.cssRules[o];let s=!1;try{s=e.querySelectorAll(n.selectorText).length>0}catch(e){console.error("Unable to check if CSS selector is used: "+n.selectorText,e)}s&&t.push(n.cssText)}}catch(e){console.error(e)}return t}$_imagesToBase64(e,t){function o(e){return fetch(e).then((e=>e.blob())).then((e=>new Promise(((t,o)=>{const n=new FileReader;n.onloadend=()=>t(n.result),n.onerror=o,n.readAsDataURL(e)})))).catch((e=>{throw console.error("Error:",e),e}))}const n=[],r=e.style.backgroundImage;if(r&&"none"!==r){const t=o(r.replace(/^url\(["']?(.*?)["']?\)$/,"$1")).then((t=>{e.style.backgroundImage=`url(${t})`}));n.push(t)}const s=e.querySelectorAll("image");s.length>0&&s.forEach((e=>{const t=e.getAttribute("href");if(t){const r=o(t).then((t=>{e.setAttribute("href",t)}));n.push(r)}})),Promise.all(n).then((()=>t()))}}class s{print(e,t){e.getBoundingClientRect();const o=t||{},n=[".rct-contextmenu-button",".rct-feedbacks",".rct-tooltip"];o.hideNavigator&&n.push(".rct-navigator"),o.hideScrollbar&&n.push(".rct-axis-scrollbar"),o.hideZoomButton&&n.push(".rct-reset-zoom")}}class i{static exportImage(e,o,n=t.PNG){(new r).export(e,o,n)}static exportPdf(e,t){}static print(e,t){(new s).print(e,t)}static render(e,o,n){const r=o.parentElement;let s=r.querySelector(".rct-contextmenu-button");s&&s.remove(),r.style.position="relative",s=e.createElement("div"),s.classList.add("rct-contextmenu-button"),s.style.position="absolute",s.onclick=e=>{c.style.display="none"===c.style.display?"block":"none"};const c=e.createElement("div");c.classList.add("rct-contextmenu"),c.style.position="absolute",c.style.display="none",c.style.right="0px";const l=e.createElement("ul");l.classList.add("rct-contextmenu-list"),c.appendChild(l),s.appendChild(c),r.appendChild(s);const a=r.getBoundingClientRect();s.style.display="block",s.style.top="20px",s.style.left=a.width-s.clientWidth-11+"px",c.style.top=s.clientHeight+"px",l.innerHTML="",n.menus.forEach((r=>{const s=e.createElement("li");switch(s.classList.add("rct-contextmenu-item"),s.id=r,r){case t.PDF:s.textContent="Download PDF",s.onclick=()=>i.exportPdf(o,n);break;case t.Print:s.textContent="Print Chart",s.onclick=()=>i.print(o,n);break;case t.PNG:case t.JPEG:case t.SVG:s.textContent=`Download ${r.toUpperCase()}`,s.onclick=()=>i.exportImage(o,n,r);break;default:return void console.error("지원하지 않는 타입입니다.")}l.appendChild(s)}))}}const c=i.exportImage,l=i.exportPdf,a=i.print,d=i.render;e.exportImage=c,e.exportPdf=l,e.print=a,e.render=d}));
